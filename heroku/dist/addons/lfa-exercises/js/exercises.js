define([],function(){String.prototype.toLowerCaseAndCleanupDiacritics=function(){for(var text=this.trim().toLocaleLowerCase(),replaceThis=["ă","â","î","ș","ț","ş","ţ","pula","pizda","muie"],withThis=["a","a","i","s","t","s","t","salut","hello","nici chiar"],i=0,j=replaceThis.length;j>i;i++)text=text.split(replaceThis[i]).join(withThis[i]);return text},String.prototype.compareIgnoringCase=function(to){return to=to||"",this.trim().toLocaleLowerCase()===to.trim().toLocaleLowerCase()},String.prototype.compareIgnoringCaseAndDiacritics=function(to){return to=to||"",this.toLowerCaseAndCleanupDiacritics()===to.toLowerCaseAndCleanupDiacritics()},String.prototype.translate=function(){return this+" (ro)"};var Exercises={store:{fetch:function(exercise){return exercise.id?(exercise.set(JSON.parse(window.App.storage.getItem("ex_"+exercise.id))),exercise.trigger("data_loaded",exercise),void exercise._render()):(console.error("Exercise should have an ID when fetched"),null)},save:function(exercise){if(!exercise.options||!exercise.options.dontSave){if(!exercise.id)return console.error("Exercise should have an ID when saved"),null;if(!exercise.attributes)return console.warn("Nothing to save. Attributes are null"),null;try{window.App.storage.setItem("ex_"+exercise.id,JSON.stringify(exercise.toJSON())),exercise.trigger("data_saved",exercise)}catch(err){throw alert("This page needs to save data locally. Please use an updated browser or leave private mode in order to continue. \n"+err),"This page needs to save data locally. Please use an updated browser or leave private mode in order to continue. "+err}}},clear:function(exercise){try{window.App.storage.removeItem("ex_"+exercise.id),exercise.trigger("data_cleared",exercise),exercise._render()}catch(err){throw alert("This page needs to save data locally. Please use an updated browser or leave private mode in order to continue. \n"+err),"This page needs to save data locally. Please use an updated browser or leave private mode in order to continue. "+err}}},_stack:[],findIdByName:function(name){return _.find(_.keys(window.App.storage),function(key){try{var attrs=JSON.parse(window.App.storage.getItem(key));return attrs.name===name}catch(E){return void 0}})},getAttributesById:function(id){if(id)try{return JSON.parse(window.App.storage.getItem(id))}catch(E){return void 0}},getAttributesByName:function(name){return this.getAttributesById(this.findByName(name))},clearAppStorage:function(){_.each(_.keys(window.App.storage),function(k){k.match(/^ex_\d+/)&&window.App.storage.removeItem(k)})},deleteStorageForId:function(id){window.App.storage.removeItem(id)},push:function(exercise){var _stack=this._stack,parent=_stack[_stack.length-1];return _stack.push(exercise),this.current=exercise,parent&&(parent.children.push(exercise),parent.listenTo(exercise,"change:state",parent._onChildChangedState),parent.listenTo(exercise,"change:score",parent._onChildChangedScore)),exercise},pop:function(){var top=this._stack.pop();return this.current=top,top.trigger("children_ready"),top._render(),top}};return Exercises});