define(["../js/exercise"],function(Exercises){var NumPad=Exercises.Exercise.extend({type:"NumPad",componentDidMount:function(){var self=this;self.answer=self.options.answer||1,self.placement=self.options.placement||"right",self.keypad=$("#ex_"+self.id+" .numpad-hidden"),self.options.placeholder=self.options.placeholder||"?",self.options.displayDecimalSeparator||self.$el.find('[data-value="."]').hide(),self.btnTrigger=$("#ex_"+self.id+" .trigger"),0===self.btnTrigger.length&&(self.btnTrigger=$('<button type="button" class="btn btn-default trigger">'+self.options.placeholder+"</button>"),self.$el.prepend(self.btnTrigger));var onChange=function(e){var code=e.which;13===code&&e.preventDefault(),(32===code||13===code||188===code||186===code)&&self.btnTrigger.popover("hide");var state=self.get("state")||"";state=e.target.value;var numDigits=self.options.numDigits;numDigits>0&&(state=state.substr(-numDigits)),self.set("state",state),self.trigger("change:state",state,self)},onClick=function(e){var state=self.get("state")||"",btn=$(e.target).data("value");switch(btn){case".":if(""===state)return;state=state+""+btn;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:if("0"===state)return;state=state+""+btn;break;case"submit":self.btnTrigger.popover("hide");break;case"clear":state="",self.$el.find("[class^=result]").text(self.options.placeholder)}var numDigits=self.options.numDigits;numDigits>0&&(state=state.substr(-numDigits)),self.set("state",state),self.answer<10&&self.btnTrigger.popover("hide")};self.popover=self.btnTrigger.popover({html:!0,placement:this.placement,content:function(){return self.keypad.html()}}),self.popover.on("shown.bs.popover",function(){var buttons=$("#ex_"+self.id+" button"),state=self.get("state")||"";$("#ex_"+self.id+" .display input").val(state),buttons.each(function(id,button){$(button).click(onClick)});var $input=$("#ex_"+self.id+" input");$input.keyup(onChange),$input.focus()})},render:function(){var self=this,state=self.get("state")||"";self.$el.find(".display input").val(state),self.$el.find(".result").text(state);for(var x=parseInt(state),numberOfDigits=1+Math.log(x)/2.302585092994046,i=0;numberOfDigits>i;i++)self.$el.find(".result"+i).text(x%10),x=Math.floor(x/10)},score:function(){var score=100*(this.get("state")===""+this.answer);return this.trigger("change:score",score),score}});return Exercises.NumPad=NumPad,Exercises});