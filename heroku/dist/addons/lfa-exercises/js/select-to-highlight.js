define(["app","../js/exercise"],function(App,Exercises){var SelectToHighlight=Exercises.Exercise.extend({type:"SelectToHighlight",componentDidMount:function(){var self=this,state=self.get("state")||[];self.$spans=self.$el.find(".good, .bad"),self.startingScore=self.options.startingScore||0,self.selectedClass=self.options.selectedClass||"selected",self.scoreN=self.options.scoreN,self.$spans.each(function(index){var $span=self.$spans.eq(index);$span.data({index:index,isGood:$span.hasClass("good")}),state[index]=state[index]||0,$span.on("click",function(){var s=self.get("state")||[];s[index]=s[index]?0:1,self.set("state",s),self.trigger("change:state",s,self)})}),self.set("state",state),self.on("change:state",function(){self.changingRemotely||App.trigger("classroom:broadcast",{action:"ex_"+self.id+":change",state:self.get("state")})})},onRemoteChanges:function(msg){var self=this,oldState=self.get("state");self.changingRemotely=!0,self.set("state",msg.state),self.changingRemotely=!1;for(var differences=[],i=0,max=Math.max(oldState.length,msg.state.length);max>i;i++){var x=oldState[i],y=msg.state[i];x!==y&&differences.push(App.T.translate(y?"selectToHighlightSelected":"selectToHighlightUnselected",self.$spans.eq(i).text()))}var notification=App.T.translate("selectToHighlightNoDescroption",[msg.from.name||msg.from.id,differences.join(", ")]);App.trigger("notify",notification)},render:function(){var self=this,state=self.get("state")||[];self.$spans.each(function(index,span){var $span=$(span);state[index]?$span.addClass(self.selectedClass):$span.removeClass(self.selectedClass)})},score:function(){var self=this,state=self.get("state")||[],s=0,n=self.scoreN||self.$spans.filter(".good").length||1;return self.$spans.each(function(index){var $span=self.$spans.eq(index),data=$span.data(),isGood=data.isGood;state[index]&&(isGood?s++:s--)}),s=Math.min(Math.max(self.startingScore+100*s/n,0),100),Math.round(s)}});return Exercises.SelectToHighlight=SelectToHighlight,Exercises});