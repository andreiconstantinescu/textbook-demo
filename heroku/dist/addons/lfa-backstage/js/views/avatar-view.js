define(function(require,exports,module){var App=require("app"),Backbone=require("backbone");module.exports=Backbone.View.extend({moods:["angry","bored","cheeky","happy","helpless","neutral","sad","sleeping","smart","smile","uneasy","unimpressed","upset","wink","wondering"],tag:"div",className:"avatar",initialize:function(){var self=this;self.moodStyles="avatar-mood-"+self.moods.join(" avatar-mood-"),App.on("avatar:mood",function(mood){if(mood&&"object"==typeof mood&&"string"==typeof mood.message){var notificationOptions={};_.extend(notificationOptions,mood),notificationOptions.$anchor=self.$el,App.trigger("notify",mood.message,notificationOptions)}self.setMood(mood)}),self.render()},clearTimeout:function(){var self=this;self.timeout&&window.clearTimeout(self.timeout),self.sleepingTimeout&&window.clearTimeout(self.timeout)},setMood:function(mood){var self=this;mood||(mood={}),"string"==typeof mood&&(mood={mood:mood}),self.mood=_.contains(self.moods,mood.mood)?mood.mood:"neutral";var interval=mood.interval||3e3;self.clearTimeout(),self.$el.removeClass(self.moodStyles).addClass("avatar-mood-"+self.mood),self.timeout=window.setTimeout(function(){self.$el.removeClass(self.moodStyles).addClass("avatar-mood-neutral")},interval),Math.random()>.8&&(self.sleepingTimeout=window.setTimeout(function(){self.$el.removeClass(self.moodStyles).addClass("avatar-mood-sleeping")},25e3))},onClick:function(){var self=this,interval=1500;Math.random()<.7?self.$el.removeClass(self.moodStyles).addClass("avatar-mood-smile"):(self.$el.removeClass(self.moodStyles).addClass("avatar-mood-"+self.moods[Math.floor(Math.random()*self.moods.length)]),interval=1500+Math.floor(5e3*Math.random())),self.timeout=window.setTimeout(function(){self.$el.removeClass(self.moodStyles).addClass("avatar-mood-neutral")},interval)},events:{click:"onClick",mouseover:"onClick"},render:function(){var self=this;return self.setMood(),self}})});